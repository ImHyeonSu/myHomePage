---
sidebar_position: 7
---

# back_end_7

**Last updated:** _2025-07-01_

##　 Injection

- 頼できないデータがコマンドやクエリの一部として送信され、意図しないコマンドが実行されたり、権限なしにデータにアクセスする脆弱性
- 発生する原因

  - 入力検証不足
  - データとコードの明確な分離失敗
  - ユーザー入力への過度な信頼
  - 不適切な権限設定

- 基本的な流れ

```
正常な入力：ユーザーが意図されたデータを入力
↓
悪意のある入力：攻撃者がコードやコマンドを混ぜて入力
↓
システム混乱：システムがデータとコマンドを区別できない
↓
意図しない実行：攻撃者のコードが実行される
```

##　 CSRF(Cross-site Request Forgery)

- CSRF はユーザーが知らないうちに攻撃者が望む要求を送信させる攻撃
  - ブラウザの自動クッキー送信機能を悪用
  - ユーザーは攻撃されている事実を知らない
  - サーバーは正常な要求として判断

```
1. ユーザーがAサイトにログイン（クッキー保存）
2. 攻撃者が悪性サイトに誘導
3. 悪性サイトから自動的にAサイトに要求送信
4. ブラウザがクッキーを自動的に含めて送信
5. Aサイトは正常な要求として認識・処理

<!-- 攻撃者サイトの隠されたコード -->
<img src="https://bank.com/transfer?to=attacker&amount=1000000" />
```

###　 CSRF 防御方法

- 自分のサイトでのみ知ることができる情報を要求に含める
- 攻撃者は予測・取得不可能
- 情報のない要求は拒否

1. Referer ヘッダー検証

```
✅ 正常：mybank.com → mybank.com
❌ 攻撃：evil.com → mybank.com
```

2. CSRF トークン（最も効果的）
   - サーバーがランダムトークン生成
   - セッションに保存
   - フォームに隠しフィールド追加
   - 要求時にトークン一致確認

```html
<input type="hidden" name="csrf_token" value="abc123xyz789" />
```

3. SameSite クッキー

```
Set-Cookie: sessionid=abc123; SameSite=Strict
効果：他のサイトからクッキー送信されない
```
